<div class="flex h-screen bg-gray-900">
  
  <!-- sidebar -->
  <div class="w-64 bg-gray-800 border-r border-gray-700 flex flex-col">
    <!-- header -->
    <div class="p-6 border-b border-gray-700">
      <h1 class="text-2xl font-bold text-white">Rhythmate</h1>
      <p class="text-gray-400 text-sm">Music Discovery</p>
    </div>

    <!-- menu de navegação -->
    <nav class="flex-1 p-4 space-y-2">
      <!-- perfil (ativo) -->
      <a routerLink="/user/profile" class="flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-purple-600 to-red-600 text-white rounded-lg transition">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
        <span>Perfil</span>
      </a>

      <!-- recomendação -->
      <a routerLink="/music/recommendation" class="flex items-center gap-3 px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
        </svg>
        <span>Recomendação</span>
      </a>

      <!-- histórico -->
      <a routerLink="/music/history" class="flex items-center gap-3 px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span>Histórico</span>
      </a>

      <!-- dashboard -->
      <a routerLink="/dashboard" class="flex items-center gap-3 px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
        </svg>
        <span>Dashboard</span>
      </a>
    </nav>

    <!-- botão de logout -->
    <div class="p-4 border-t border-gray-700">
      <button (click)="logout()" class="flex items-center gap-3 px-4 py-3 w-full text-gray-300 hover:bg-red-900/30 hover:text-red-400 rounded-lg transition">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
        </svg>
        <span>Sair</span>
      </button>
    </div>
  </div>

  <!-- tela perfil -->
  <div class="flex-1 overflow-auto">

    <!-- gradiente com glass effect -->
    <div class="h-[20vh] bg-black relative overflow-hidden border-b border-gray-700">
      <!-- Camada 1: diagonal superior esquerda pra inferior direita-->
      <div class="absolute inset-0 bg-gradient-to-br from-purple-900/70 via-transparent to-transparent"></div>
      
      <!-- Camada 2: diagonal inferior esquerda pra superior direita -->
      <div class="absolute inset-0 bg-gradient-to-tr from-red-900/60 via-transparent to-purple-800/40"></div>
      
      <!-- Camada 3: radial centro pra fora-->
      <div class="absolute inset-0 bg-gradient-to-r from-transparent via-purple-950/50 to-red-950/70"></div>
      
      <!-- glass effect-->
      <div class="absolute inset-0 backdrop-blur-sm bg-black/20"></div>
    </div>

    <div class="p-8 max-w-5xl mx-auto">
      
      <!-- searchbar -->
      <div class="mb-8">
        <form (ngSubmit)="searchUser()">
          <div class="flex gap-4">
            <input
              type="text"
              [(ngModel)]="searchInput"
              name="searchInput"
              placeholder="Buscar usuário pelo username..."
              class="flex-1 px-6 py-4 bg-gray-800 border border-gray-700 rounded-lg text-white text-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition"
            />
            <button
              type="submit"
              [disabled]="isSearching"
              class="px-8 py-4 bg-gradient-to-r from-purple-600 to-red-600 text-white font-semibold text-lg rounded-lg hover:from-purple-700 hover:to-red-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
            >
              <svg *ngIf="!isSearching" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
              <span *ngIf="!isSearching">Buscar</span>
              <span *ngIf="isSearching">Buscando...</span>
            </button>
          </div>
        </form>
      </div>

      <!-- loading do perfil -->
      <div *ngIf="isLoadingProfile" class="bg-gray-800 rounded-lg p-12 text-center">
        <div class="animate-spin h-12 w-12 border-4 border-purple-600 border-t-transparent rounded-full mx-auto"></div>
        <p class="text-gray-400 mt-4 text-lg">Carregando perfil...</p>
      </div>

      <!-- erro ao carregar perfil -->
      <div *ngIf="errorMessage" class="bg-red-900/50 border border-red-700 text-red-300 px-6 py-4 rounded-lg text-center">
        {{ errorMessage }}
      </div>

      <!-- erro na busca -->
      <div *ngIf="searchErrorMessage" class="bg-yellow-900/50 border border-yellow-700 text-yellow-300 px-6 py-4 rounded-lg text-center mb-8">
        {{ searchErrorMessage }}
      </div>

      <!-- perfil do usuário pesquisado -->
      <div *ngIf="searchedProfile && !isLoadingProfile" class="bg-gray-800 rounded-xl p-10 shadow-2xl">
        <!-- botão voltar -->
        <button 
          (click)="clearSearch()"
          class="flex items-center gap-2 text-gray-400 hover:text-white mb-6 transition"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          <span>Voltar ao meu perfil</span>
        </button>

        <div class="flex items-center gap-12">
          <!-- lado esquerdo: foto e username -->
          <div class="flex flex-col items-center">
            <div class="mb-6">
              <div *ngIf="searchedProfile.profile_picture" class="w-48 h-48 rounded-full overflow-hidden border-4 border-cyan-500 shadow-lg">
                <img [src]="searchedProfile.profile_picture" [alt]="searchedProfile.username" class="w-full h-full object-cover" />
              </div>
              <div *ngIf="!searchedProfile.profile_picture" class="w-48 h-48 rounded-full bg-gradient-to-br from-blue-600 to-cyan-600 flex items-center justify-center text-white text-7xl font-bold shadow-lg">
                {{ searchedProfile.username.charAt(0).toUpperCase() }}
              </div>
            </div>
            <p class="text-white text-3xl font-bold">{{ searchedProfile.username }}</p>
          </div>

          <!-- lado direito: email e gênero musical -->
          <div class="flex-1 flex items-start ml-auto justify-end mr-8">
            <div class="space-y-8 w-auto">
              <div *ngIf="isOwnProfile(searchedProfile)">
                <label class="text-gray-500 text-sm uppercase tracking-wider block mb-2">Email</label>
                <p class="text-white text-2xl">{{ searchedProfile.email }}</p>
              </div>

              <div>
                <label class="text-gray-500 text-sm uppercase tracking-wider block mb-2">Gênero Musical Favorito</label>
                <p class="text-cyan-400 text-3xl font-semibold">{{ searchedProfile.favorite_music_genre || 'Não informado' }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- perfil do usuário logado -->
      <div *ngIf="!searchedProfile && !isLoadingProfile && currentUserProfile" class="bg-gray-800 rounded-xl p-10 shadow-2xl">
        
        <!-- modo normal: visualização do perfil -->
        <div *ngIf="!isEditingProfilePicture" class="flex items-center gap-12">
          <!-- lado esquerdo: foto e username -->
          <div class="flex flex-col items-center">
            <div class="mb-6 relative group">
              <div *ngIf="currentUserProfile.profile_picture" class="w-48 h-48 rounded-full overflow-hidden border-4 border-purple-500 shadow-lg">
                <img [src]="currentUserProfile.profile_picture" [alt]="currentUserProfile.username" class="w-full h-full object-cover" />
              </div>
              <div *ngIf="!currentUserProfile.profile_picture" class="w-48 h-48 rounded-full bg-gradient-to-br from-purple-600 to-red-600 flex items-center justify-center text-white text-7xl font-bold shadow-lg">
                {{ currentUserProfile.username.charAt(0).toUpperCase() }}
              </div>
              
              <!-- botão de editar foto -->
              <button 
                (click)="enableEditMode()"
                class="absolute bottom-2 right-2 w-12 h-12 bg-purple-600 hover:bg-purple-700 rounded-full flex items-center justify-center shadow-lg transition opacity-0 group-hover:opacity-100"
                title="Alterar foto de perfil"
              >
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
              </button>
            </div>
            <p class="text-white text-3xl font-bold">{{ currentUserProfile.username }}</p>
          </div>

          <!-- lado direito: email e gênero musical -->
          <div class="flex-1 flex">
            <div class="space-y-8 w-auto ml-auto mr-16">
              <div>
                <label class="text-gray-500 text-sm uppercase tracking-wider block mb-2">Email</label>
                <p class="text-white text-2xl">{{ currentUserProfile.email }}</p>
              </div>

              <div>
                <label class="text-gray-500 text-sm uppercase tracking-wider block mb-2">Gênero Musical Favorito</label>
                <p class="text-purple-400 text-3xl font-semibold">{{ currentUserProfile.favorite_music_genre || 'Não informado' }}</p>
              </div>
              
              <div>
                <button
                  (click)="openShareProfileModal()"
                  class="px-6 py-3 bg-gradient-to-r from-purple-600 to-red-600 text-white font-semibold rounded-lg hover:from-purple-700 hover:to-red-700 transition flex items-center gap-2 shadow-lg"
                  title="Compartilhar perfil por email"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                  </svg>
                  Compartilhar Perfil
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- modo edição: upload de foto -->
        <div *ngIf="isEditingProfilePicture" class="space-y-6">
          <!-- botão voltar -->
          <button 
            (click)="cancelEditMode()"
            class="flex items-center gap-2 text-gray-400 hover:text-white transition"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            <span>Voltar</span>
          </button>
          
          <h2 class="text-white text-2xl font-bold">Alterar Foto de Perfil</h2>
          
          <!-- drag and drop -->
          <div 
            (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)"
            (drop)="onDrop($event)"
            [class.border-purple-500]="isDragging"
            [class.bg-purple-900/20]="isDragging"
            class="border-2 border-dashed border-gray-600 rounded-lg p-12 text-center transition-all"
          >
            <!-- preview da imagem selecionada -->
            <div *ngIf="previewUrl" class="space-y-6">
              <img [src]="previewUrl" alt="Preview" class="w-64 h-64 rounded-full object-cover mx-auto border-4 border-purple-500 shadow-lg" />
              <p class="text-gray-300 text-lg">{{ selectedFile?.name }}</p>
            </div>
            
            <!-- upload sem preview -->
            <div *ngIf="!previewUrl" class="space-y-4">
              <svg class="w-20 h-20 text-gray-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
              </svg>
              <p class="text-gray-300 text-xl">Arraste uma imagem aqui</p>
              <p class="text-gray-500">ou</p>
              <label class="inline-block px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg cursor-pointer transition">
                Selecionar arquivo
                <input type="file" accept="image/*" (change)="onFileSelected($event)" class="hidden" />
              </label>
              <p class="text-gray-500 text-sm">Formatos aceitos: JPG, PNG, GIF (máximo 5MB)</p>
            </div>
          </div>
          
          <!-- mensagem de erro -->
          <div *ngIf="uploadErrorMessage" class="bg-red-900/50 border border-red-700 text-red-300 px-6 py-4 rounded-lg">
            {{ uploadErrorMessage }}
          </div>
          
          <!-- botão de upload -->
          <div *ngIf="selectedFile" class="flex gap-4">
            <button 
              (click)="uploadProfilePicture()"
              [disabled]="isUploadingPicture"
              class="flex-1 px-6 py-4 bg-gradient-to-r from-purple-600 to-red-600 text-white font-semibold text-lg rounded-lg hover:from-purple-700 hover:to-red-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span *ngIf="!isUploadingPicture">Salvar Foto</span>
              <span *ngIf="isUploadingPicture">Enviando...</span>
            </button>
            <button 
              (click)="selectedFile = null; previewUrl = null"
              [disabled]="isUploadingPicture"
              class="px-6 py-4 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Cancelar
            </button>
          </div>
        </div>
        
      </div>

    </div>
  </div>

</div>

<!-- compartilhar perfil -->
<div 
  *ngIf="showShareProfileModal"
  class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"
  (click)="closeShareProfileModal()"
>
  <div 
    class="bg-gray-800 rounded-xl p-8 max-w-md w-full shadow-2xl"
    (click)="$event.stopPropagation()"
  >
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-white text-2xl font-bold">Compartilhar Perfil</h3>
      <button 
        (click)="closeShareProfileModal()"
        class="text-gray-400 hover:text-white transition"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    
    <div class="space-y-4">
      <!-- campo de email -->
      <div>
        <label class="text-gray-400 text-sm block mb-2">Email do destinatário</label>
        <input
          type="email"
          [(ngModel)]="shareProfileEmail"
          placeholder="exemplo@email.com"
          class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
          [disabled]="isSharingProfile"
        />
      </div>
      
      <!-- campo de mensagem opcional -->
      <div>
        <label class="text-gray-400 text-sm block mb-2">Mensagem (opcional)</label>
        <textarea
          [(ngModel)]="shareProfileMessage"
          placeholder="Adicione uma mensagem personalizada..."
          rows="3"
          class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none"
          [disabled]="isSharingProfile"
        ></textarea>
      </div>
      
      <!-- mensagens de erro/sucesso -->
      <div *ngIf="shareProfileErrorMessage" class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg text-sm">
        {{ shareProfileErrorMessage }}
      </div>
      
      <div *ngIf="shareProfileSuccessMessage" class="bg-green-900/50 border border-green-700 text-green-300 px-4 py-3 rounded-lg text-sm">
        {{ shareProfileSuccessMessage }}
      </div>
      
      <!-- botões -->
      <div class="flex gap-3 pt-2">
        <button
          (click)="shareProfile()"
          [disabled]="isSharingProfile || !shareProfileEmail.trim()"
          class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-red-600 text-white font-semibold rounded-lg hover:from-purple-700 hover:to-red-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
        >
          <svg *ngIf="!isSharingProfile" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
          </svg>
          <span *ngIf="!isSharingProfile">Compartilhar</span>
          <span *ngIf="isSharingProfile">Enviando...</span>
        </button>
        
        <button
          (click)="closeShareProfileModal()"
          [disabled]="isSharingProfile"
          class="px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Cancelar
        </button>
      </div>
    </div>
  </div>
</div>
